"use strict";
/*
 * MIT License
 *
 * Copyright (c) 2020 RÃ©mi Van Keisbelck
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.place1DStart = exports.place1DEnd = exports.placeCombo = exports.place = void 0;
const Box_1 = require("./Box");
const Dim_1 = require("./Dim");
const Pos_1 = require("./Pos");
function place(viewport, refBox, elem) {
    const pX = place1DEnd(viewport.w, refBox.p.x, refBox.d.w, elem.w);
    const pY = place1DStart(viewport.h, refBox.p.y, refBox.d.h, elem.h);
    return Box_1.box(Pos_1.pos(pX.offset, pY.offset), Dim_1.dim(pX.len, pY.len));
}
exports.place = place;
function placeCombo(viewport, refBox, elem) {
    const pX = place1DStart(viewport.w, refBox.p.x, refBox.d.w, elem.w);
    const pY = placeComboY(viewport.h, refBox.p.y, refBox.d.h, elem.h);
    return Box_1.box(Pos_1.pos(pX.offset, pY.offset), Dim_1.dim(pX.len, pY.len));
}
exports.placeCombo = placeCombo;
function place1DEnd(viewportW, refX, refW, elemW) {
    if (refX + refW + elemW > viewportW) {
        // not enough space after, try before
        if (elemW < refX) {
            // ok, prepend
            return { offset: refX - elemW, len: elemW };
        }
        else {
            // not enough space before or after, we have to translate and/or expand !
            if (elemW < viewportW) {
                // can't append or prepend, but no need to shrink... translate only
                const delta = refX + refW + elemW - viewportW;
                return { offset: refX + refW - delta, len: elemW };
            }
            return { offset: 0, len: viewportW };
        }
    }
    else {
        // enough space to append
        return { offset: refX + refW, len: elemW };
    }
}
exports.place1DEnd = place1DEnd;
function place1DStart(viewportW, refX, refW, elemW) {
    if (elemW > viewportW) {
        return { offset: 0, len: viewportW };
    }
    if (refX + elemW > viewportW) {
        // not enough space after, try before
        if (elemW < refX + refW) {
            // ok, prepend
            return { offset: refX + refW - elemW, len: elemW };
        }
        else {
            // not enough space before or after, we have to translate and/or expand !
            if (elemW < viewportW) {
                // can't append or prepend, but no need to shrink... translate only
                const delta = refX + refW + elemW - viewportW;
                return { offset: refX + refW - delta, len: elemW };
            }
            return { offset: 0, len: 10 };
        }
    }
    else {
        // enough space to append
        return { offset: refX, len: elemW };
    }
}
exports.place1DStart = place1DStart;
function placeComboY(viewportW, refX, refW, elemW) {
    const elemEnd = refX + refW;
    const spaceBefore = refX;
    const spaceAfter = viewportW - elemEnd;
    if (elemW < spaceAfter) {
        // enough space after, append
        return { offset: elemEnd, len: elemW };
    }
    else if (elemW < spaceBefore) {
        // enough space before, append
        return { offset: refX - elemW, len: elemW };
    }
    else {
        // not enough space, need to shrink
        // use the most space
        if (spaceBefore > spaceAfter) {
            // place before
            return { offset: 0, len: spaceBefore };
        }
        else {
            return { offset: elemEnd, len: spaceAfter };
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUG9wb3Zlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tb24vUG9wb3Zlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHOzs7QUFFSCwrQkFBaUM7QUFDakMsK0JBQWlDO0FBQ2pDLCtCQUE0QjtBQUU1QixTQUFnQixLQUFLLENBQUMsUUFBYSxFQUFFLE1BQVcsRUFBRSxJQUFTO0lBQ3pELE1BQU0sRUFBRSxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsRSxNQUFNLEVBQUUsR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEUsT0FBTyxTQUFHLENBQUMsU0FBRyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQzdELENBQUM7QUFKRCxzQkFJQztBQUVELFNBQWdCLFVBQVUsQ0FBQyxRQUFhLEVBQUUsTUFBVyxFQUFFLElBQVM7SUFDOUQsTUFBTSxFQUFFLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLE1BQU0sRUFBRSxHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLE1B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QUFLLEdBQUcsVUFBVSxFQUFFO1FBQ3RCLDZCQUE2QjtRQUM3QixPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLENBQUM7S0FDeEM7U0FBTSxJQUFJLEtBQUssR0FBRyxXQUFXLEVBQUU7UUFDOUIsOEJBQThCO1FBQzlCLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLENBQUM7S0FDN0M7U0FBTTtRQUNMLG1DQUFtQztRQUNuQyxxQkFBcUI7UUFDckIsSUFBSSxXQUFXLEdBQUcsVUFBVSxFQUFFO1lBQzVCLGVBQWU7WUFDZixPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLENBQUM7U0FDeEM7YUFBTTtZQUNMLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsQ0FBQztTQUM3QztLQUNGO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNSVQgTGljZW5zZVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAyMCBSw6ltaSBWYW4gS2Vpc2JlbGNrXG4gKlxuICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuICogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4gKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuICpcbiAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuICogY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbiAqXG4gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG4gKiBTT0ZUV0FSRS5cbiAqXG4gKi9cblxuaW1wb3J0IHsgYm94LCBCb3ggfSBmcm9tICcuL0JveCc7XG5pbXBvcnQgeyBkaW0sIERpbSB9IGZyb20gJy4vRGltJztcbmltcG9ydCB7IHBvcyB9IGZyb20gJy4vUG9zJztcblxuZXhwb3J0IGZ1bmN0aW9uIHBsYWNlKHZpZXdwb3J0OiBEaW0sIHJlZkJveDogQm94LCBlbGVtOiBEaW0pOiBCb3gge1xuICBjb25zdCBwWCA9IHBsYWNlMURFbmQodmlld3BvcnQudywgcmVmQm94LnAueCwgcmVmQm94LmQudywgZWxlbS53KTtcbiAgY29uc3QgcFkgPSBwbGFjZTFEU3RhcnQodmlld3BvcnQuaCwgcmVmQm94LnAueSwgcmVmQm94LmQuaCwgZWxlbS5oKTtcbiAgcmV0dXJuIGJveChwb3MocFgub2Zmc2V0LCBwWS5vZmZzZXQpLCBkaW0ocFgubGVuLCBwWS5sZW4pKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBsYWNlQ29tYm8odmlld3BvcnQ6IERpbSwgcmVmQm94OiBCb3gsIGVsZW06IERpbSk6IEJveCB7XG4gIGNvbnN0IHBYID0gcGxhY2UxRFN0YXJ0KHZpZXdwb3J0LncsIHJlZkJveC5wLngsIHJlZkJveC5kLncsIGVsZW0udyk7XG4gIGNvbnN0IHBZID0gcGxhY2VDb21ib1kodmlld3BvcnQuaCwgcmVmQm94LnAueSwgcmVmQm94LmQuaCwgZWxlbS5oKTtcbiAgcmV0dXJuIGJveChwb3MocFgub2Zmc2V0LCBwWS5vZmZzZXQpLCBkaW0ocFgubGVuLCBwWS5sZW4pKTtcbn1cblxuaW50ZXJmYWNlIFBsYWNlZDFEIHtcbiAgcmVhZG9ubHkgb2Zmc2V0OiBudW1iZXI7XG4gIHJlYWRvbmx5IGxlbjogbnVtYmVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGxhY2UxREVuZChcbiAgdmlld3BvcnRXOiBudW1iZXIsXG4gIHJlZlg6IG51bWJlcixcbiAgcmVmVzogbnVtYmVyLFxuICBlbGVtVzogbnVtYmVyLFxuKTogUGxhY2VkMUQge1xuICBpZiAocmVmWCArIHJlZlcgKyBlbGVtVyA+IHZpZXdwb3J0Vykge1xuICAgIC8vIG5vdCBlbm91Z2ggc3BhY2UgYWZ0ZXIsIHRyeSBiZWZvcmVcbiAgICBpZiAoZWxlbVcgPCByZWZYKSB7XG4gICAgICAvLyBvaywgcHJlcGVuZFxuICAgICAgcmV0dXJuIHsgb2Zmc2V0OiByZWZYIC0gZWxlbVcsIGxlbjogZWxlbVcgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbm90IGVub3VnaCBzcGFjZSBiZWZvcmUgb3IgYWZ0ZXIsIHdlIGhhdmUgdG8gdHJhbnNsYXRlIGFuZC9vciBleHBhbmQgIVxuICAgICAgaWYgKGVsZW1XIDwgdmlld3BvcnRXKSB7XG4gICAgICAgIC8vIGNhbid0IGFwcGVuZCBvciBwcmVwZW5kLCBidXQgbm8gbmVlZCB0byBzaHJpbmsuLi4gdHJhbnNsYXRlIG9ubHlcbiAgICAgICAgY29uc3QgZGVsdGEgPSByZWZYICsgcmVmVyArIGVsZW1XIC0gdmlld3BvcnRXO1xuICAgICAgICByZXR1cm4geyBvZmZzZXQ6IHJlZlggKyByZWZXIC0gZGVsdGEsIGxlbjogZWxlbVcgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IG9mZnNldDogMCwgbGVuOiB2aWV3cG9ydFcgfTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gZW5vdWdoIHNwYWNlIHRvIGFwcGVuZFxuICAgIHJldHVybiB7IG9mZnNldDogcmVmWCArIHJlZlcsIGxlbjogZWxlbVcgfTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGxhY2UxRFN0YXJ0KFxuICB2aWV3cG9ydFc6IG51bWJlcixcbiAgcmVmWDogbnVtYmVyLFxuICByZWZXOiBudW1iZXIsXG4gIGVsZW1XOiBudW1iZXIsXG4pOiBQbGFjZWQxRCB7XG4gIGlmIChlbGVtVyA+IHZpZXdwb3J0Vykge1xuICAgIHJldHVybiB7IG9mZnNldDogMCwgbGVuOiB2aWV3cG9ydFcgfTtcbiAgfVxuICBpZiAocmVmWCArIGVsZW1XID4gdmlld3BvcnRXKSB7XG4gICAgLy8gbm90IGVub3VnaCBzcGFjZSBhZnRlciwgdHJ5IGJlZm9yZVxuICAgIGlmIChlbGVtVyA8IHJlZlggKyByZWZXKSB7XG4gICAgICAvLyBvaywgcHJlcGVuZFxuICAgICAgcmV0dXJuIHsgb2Zmc2V0OiByZWZYICsgcmVmVyAtIGVsZW1XLCBsZW46IGVsZW1XIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG5vdCBlbm91Z2ggc3BhY2UgYmVmb3JlIG9yIGFmdGVyLCB3ZSBoYXZlIHRvIHRyYW5zbGF0ZSBhbmQvb3IgZXhwYW5kICFcbiAgICAgIGlmIChlbGVtVyA8IHZpZXdwb3J0Vykge1xuICAgICAgICAvLyBjYW4ndCBhcHBlbmQgb3IgcHJlcGVuZCwgYnV0IG5vIG5lZWQgdG8gc2hyaW5rLi4uIHRyYW5zbGF0ZSBvbmx5XG4gICAgICAgIGNvbnN0IGRlbHRhID0gcmVmWCArIHJlZlcgKyBlbGVtVyAtIHZpZXdwb3J0VztcbiAgICAgICAgcmV0dXJuIHsgb2Zmc2V0OiByZWZYICsgcmVmVyAtIGRlbHRhLCBsZW46IGVsZW1XIH07XG4gICAgICB9XG4gICAgICByZXR1cm4geyBvZmZzZXQ6IDAsIGxlbjogMTAgfTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gZW5vdWdoIHNwYWNlIHRvIGFwcGVuZFxuICAgIHJldHVybiB7IG9mZnNldDogcmVmWCwgbGVuOiBlbGVtVyB9O1xuICB9XG59XG5cbmZ1bmN0aW9uIHBsYWNlQ29tYm9ZKFxuICB2aWV3cG9ydFc6IG51bWJlcixcbiAgcmVmWDogbnVtYmVyLFxuICByZWZXOiBudW1iZXIsXG4gIGVsZW1XOiBudW1iZXIsXG4pOiBQbGFjZWQxRCB7XG4gIGNvbnN0IGVsZW1FbmQgPSByZWZYICsgcmVmVztcbiAgY29uc3Qgc3BhY2VCZWZvcmUgPSByZWZYO1xuICBjb25zdCBzcGFjZUFmdGVyID0gdmlld3BvcnRXIC0gZWxlbUVuZDtcbiAgaWYgKGVsZW1XIDwgc3BhY2VBZnRlcikge1xuICAgIC8vIGVub3VnaCBzcGFjZSBhZnRlciwgYXBwZW5kXG4gICAgcmV0dXJuIHsgb2Zmc2V0OiBlbGVtRW5kLCBsZW46IGVsZW1XIH07XG4gIH0gZWxzZSBpZiAoZWxlbVcgPCBzcGFjZUJlZm9yZSkge1xuICAgIC8vIGVub3VnaCBzcGFjZSBiZWZvcmUsIGFwcGVuZFxuICAgIHJldHVybiB7IG9mZnNldDogcmVmWCAtIGVsZW1XLCBsZW46IGVsZW1XIH07XG4gIH0gZWxzZSB7XG4gICAgLy8gbm90IGVub3VnaCBzcGFjZSwgbmVlZCB0byBzaHJpbmtcbiAgICAvLyB1c2UgdGhlIG1vc3Qgc3BhY2VcbiAgICBpZiAoc3BhY2VCZWZvcmUgPiBzcGFjZUFmdGVyKSB7XG4gICAgICAvLyBwbGFjZSBiZWZvcmVcbiAgICAgIHJldHVybiB7IG9mZnNldDogMCwgbGVuOiBzcGFjZUJlZm9yZSB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4geyBvZmZzZXQ6IGVsZW1FbmQsIGxlbjogc3BhY2VBZnRlciB9O1xuICAgIH1cbiAgfVxufVxuIl19